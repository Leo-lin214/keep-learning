# Webpack ä¼˜åŒ–--æ„å»ºé€Ÿåº¦ç¯‡

åœ¨æ—¥å¸¸çš„å¼€å‘æ„å»ºè¿‡ç¨‹æˆ–ç”Ÿäº§æ‰“åŒ…æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šé‡åˆ°è¿‡å› ä¸ºæ„å»ºé€Ÿåº¦éå¸¸ç¼“æ…¢å¯¼è‡´è€—æ—¶ä¸¥é‡ï¼Œä¸ä»…å¾—è®©æˆ‘ä»¬æŠŠæ—¶é—´æµªè´¹åœ¨ç­‰å¾…çš„æ—¶é—´ï¼Œæœ€é‡è¦çš„è¿˜å¾—ä¼šç›´æ¥å½±å“åˆ°æˆ‘ä»¬çš„åŠ ç­å•Š...ğŸ˜‚

æ‰€ä»¥ä¼˜åŒ– Webpack çš„æ„å»ºé€Ÿåº¦æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚å½“é¡¹ç›®åºå¤§æ—¶æ„å»ºçš„è€—æ—¶å¯èƒ½ä¼šå˜å¾—æ›´é•¿ï¼Œæ¯æ¬¡ç­‰å¾…æ„å»ºçš„è€—æ—¶åŠ èµ·æ¥ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¤§æ•°ç›®ã€‚

ä¸ºæ­¤ï¼Œå¾—æ€»ç»“ä¸€ä¸‹å¦‚ä½•åœ¨ Webpack æ„å»ºè¿‡ç¨‹é‡ŒåŠ å¿«é€Ÿåº¦ã€‚ğŸ¤”

## ä½¿ç”¨resolveç¼©å°‘æ–‡ä»¶çš„æœç´¢èŒƒå›´

Webpack åœ¨å¯åŠ¨åä¼š**ä»é…ç½®çš„ Entry å…¥å£å‡ºå‘ï¼Œè§£æå‡ºæ–‡ä»¶ä¸­çš„å¯¼å…¥è¯­å¥ï¼Œå†é€’å½’è§£æ**ã€‚

Webpack åœ¨è§£ææ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°å¯¼å…¥è¯­å¥æ—¶ï¼Œä¼šåšä¸¤ä»¶äº‹ï¼š

- æ ¹æ®å¯¼å…¥è¯­å¥å»å¯»æ‰¾å¯¹åº”çš„è¦å¯¼å…¥çš„æ–‡ä»¶ã€‚
- æ‰¾åˆ°å¯¹åº”æ–‡ä»¶åï¼Œæ ¹æ®åŒ¹é…åˆ°çš„åç¼€åï¼Œç„¶åä½¿ç”¨é…ç½®ä¸­ç›¸åº”çš„ Loader å¤„ç†è¯¥æ–‡ä»¶ã€‚

åœ¨å°å‹é¡¹ç›®ä¸­ï¼Œä¸Šè¿°ä¸¤ä¸ªè¿‡ç¨‹éƒ½ä¼šå¾ˆå¿«ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªåºå¤§ç³»ç»Ÿæ¥è¯´ï¼Œå¯»æ‰¾è§£æå°±ä¼šæ˜¾å¾—å°¤ä¸ºåƒåŠ›ï¼Œè¿™æ ·æ„å»ºé€Ÿåº¦ä¹Ÿä¼šæ…¢æ…¢å‡¸æ˜¾å‡ºæ¥ã€‚

> Loader ä¸­ä½¿ç”¨ include é’ˆå¯¹æ€§åœ°å¤„ç†æ–‡ä»¶

åœ¨ Loader ä¸­é€šè¿‡é…ç½®å…¶ include å±æ€§ï¼Œå¯**é’ˆå¯¹æ€§åœ°å¯¹ä¸»è¦ç›®å½•è¿›è¡Œé€’å½’è§£æ**ï¼Œå¯æœ‰æ•ˆåœ°é¿å…å¤„ç†å…¶ä»–æ²¡å¿…è¦ç›®å½•çš„é€’å½’è§£æã€‚

```javascript
module: {
  rules: [
    {
      test: /\.js$/,
      use: ['babel-loader'],
      include: path.resolve(__dirname, 'src') // åªå¯¹srcç›®å½•è¿›è¡Œé€’å½’è§£æï¼Œå…¶ä»–ç›®å½•ä¸€å¾‹ä¸è§£æ
    }
  ]
}
```

> é…ç½® resolve.modules å‡å°‘ç¬¬ä¸‰æ–¹æ¨¡å—æŸ¥æ‰¾æµç¨‹

å¦‚æœæœ‰äº†è§£è¿‡ NodeJs çš„ç«¥é‹ï¼Œç›¸ä¿¡å¯¹äºå…¶åŠ è½½æ¨¡å—æœºåˆ¶ä¼šäº†è§£ï¼Œè¿™é‡Œå°±æ¥ç®€å•æè¿°ä¸€ä¸‹ã€‚

åœ¨ Javascript ä¸»è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“é‡åˆ°è¦åŠ è½½çš„ç¬¬ä¸‰æ–¹æ¨¡å—æ—¶ï¼Œä¼šåœ¨å½“å‰æ–‡ä»¶å¯¹åº”çš„ç›®å½•ä¸‹çš„ node_modules æ–‡ä»¶å¤¹å»å¯»æ‰¾è¯¥æ¨¡å—ï¼Œè‹¥æ— åˆ™ä¼šå‘ä¸Šä¸€å±‚çš„ç›®å½•ä¸‹çš„ node_modules ï¼ˆå³ ../node_modules æ–‡ä»¶å¤¹ï¼‰å»æŸ¥æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ã€‚

åœ¨ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ— ç–‘ä¼šäº§ç”Ÿå¾ˆå¤šæ²¡å¿…è¦çš„éå†æŸ¥æ‰¾è¿‡ç¨‹ï¼Œä¸ºæ­¤ï¼Œ**é…ç½® resolve.modules ä¼šç›´æ¥æŒ‡å®šåœ¨ç›¸åº”çš„ç›®å½•ä¸‹è¿›è¡ŒæŸ¥æ‰¾ï¼Œä»¥å‡å°‘æ²¡å¿…è¦çš„æŸ¥æ‰¾è¿‡ç¨‹**ã€‚

```javascript
resolve: {
  modules: [path.resolve(__dirname, 'node_modules')]
}
```

> é…ç½® resolve.mainFields å‡å°‘ç¬¬ä¸‰æ–¹æ¨¡å—å…¥å£æŸ¥æ‰¾æµç¨‹

åœ¨å¼€å‘è¿‡ç¨‹ä¸­å®‰è£…çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œéƒ½ä¼šè‡ªå¸¦ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œç”¨äºæè¿°è¯¥æ¨¡å—çš„å±æ€§ï¼ŒåŒ…æ‹¬å…¥å£æ–‡ä»¶çš„å®šä¹‰ã€‚

**ç¬¬ä¸‰æ–¹æ¨¡å—çš„å…¥å£æ–‡ä»¶å¯ä»¥æœ‰ browserã€moduleã€main ä¸‰ä¸ªå±æ€§è¿›è¡Œå®šä¹‰**ã€‚è€Œ **reslove.mainFields å¯ç”¨äºé…ç½®ç›´æ¥ä»å“ªä¸ªå±æ€§è¿›è¡Œå…¥æ‰‹åŠ è½½ç¬¬ä¸‰æ–¹æ¨¡å—**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œreslove.mainFields å’Œå½“å‰ç¯å¢ƒ target ç›¸å…³è”ã€‚

-  å½“ target ä¸º web æˆ–è€… webworker æ—¶ï¼Œé»˜è®¤å€¼æ˜¯["browser", "module", "main"]ï¼›
- å½“ target ä¸ºå…¶ä»–æƒ…å†µæ—¶ï¼Œå€¼æ˜¯["module", "main"]ï¼›

**ç”±äºç»å¤§å¤šæ•°ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½é‡‡ç”¨ main å­—æ®µæ¥æè¿°å…¥å£ï¼Œä¸ºå‡å°‘æœç´¢å…¥å£æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é…ç½® resolve.mainFields ä¸º main**ã€‚

```javascript
resolve: {
  mainFields: ["main"]
}
```

> é…ç½® resolve.alias å‡å°‘å®Œæ•´ç¬¬ä¸‰æ–¹æ¨¡å—çš„æŸ¥æ‰¾ä¾èµ–æµç¨‹

ä»¥ Vue ä¸ºä¾‹ï¼Œåœ¨æ‰“åŒ…åï¼Œéƒ½ä¼šå­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ vue.jsï¼Œå¦ä¸€ä¸ªæ˜¯ vue.min.jsã€‚å‰è€…ç”¨äºå¼€å‘ç¯å¢ƒï¼Œè€Œåè€…ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

å¼€å‘ç¯å¢ƒä¸‹ï¼ŒWebpack åœ¨æ„å»ºè¿‡ç¨‹é‡åˆ°éœ€è¦å¼•å…¥ vue æ—¶ï¼Œä¼šç›´æ¥å¯»æ‰¾ vue.jsã€‚æˆ‘ä»¬åº”è¯¥çŸ¥é“ vue.js ä¼šåˆ†ä¸ºå¾ˆå¤šä¸ªæ–‡ä»¶ç»„æˆï¼Œåœ¨æ‰§è¡Œ vue.js æ—¶å°±éœ€è¦æ ¹æ®ä¸åŒåœºæ™¯å»å¼•å…¥ç›¸åº”æ¨¡å—è¿›è¡Œè§£æï¼Œè¿™è¿‡ç¨‹å°±ä¼šå¯¼è‡´è€—æ—¶å¤§ã€‚

ä¸ºæ­¤ï¼Œ**é…ç½® resolve.alias å¯ä»¥è®© Webpack åœ¨å¤„ç† vue æ—¶ï¼Œç›´æ¥ä½¿ç”¨å•ç‹¬ã€å®Œæ•´çš„ vue.min.js æ–‡ä»¶ï¼Œä»è€Œè·³è¿‡è€—æ—¶çš„é€’å½’è§£ææ“ä½œ**ã€‚

```javascript
resolve: {
  alias: {
    'vue': path.resolve(__dirname, './node_modules/vue/dist/vue.min.js')
  }
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½å¯ä»¥è¿™æ ·å¤„ç†ã€‚åªæœ‰å®Œæ•´çš„ç¬¬ä¸‰æ–¹æ¨¡å—æ‰å¯ä»¥ï¼Œé‚£ä»€ä¹ˆæ˜¯å®Œæ•´çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ª vue æ„å»ºé¡¹ç›®ï¼ŒåŸºæœ¬æ¯ä¸€ä¸ªæºä»£ç éƒ½éœ€è¦ç”¨åˆ°ï¼Œå› æ­¤å®ƒæ˜¯å®Œæ•´çš„ï¼Œå†æ¯”å¦‚ lodash.jsï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦æŒ‰éœ€å¼•å…¥éƒ¨åˆ†æ–¹æ³•ï¼Œè€Œä¸”æœ‰ç»å¤§éƒ¨åˆ†çš„æºç æˆ‘ä»¬æ˜¯æ²¡å¿…è¦å¼•ç”¨çš„ï¼Œå› æ­¤å®ƒæ˜¯ä¸å®Œæ•´çš„ã€‚

**é…ç½® resolve.alias åªèƒ½åœ¨éœ€è¦å…¨éƒ¨æºä»£ç çš„ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡Œä½¿ç”¨ï¼ŒæŒ‰éœ€ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¸€å¾‹ä¸èƒ½ä½¿ç”¨**ã€‚

**è‹¥å¼ºåˆ¶åœ¨ä¸å®Œæ•´çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­ä½¿ç”¨ resolve.alias é…ç½®ï¼Œé‚£ä¹ˆåœ¨ Tree-Shaking è¿‡ç¨‹ä¸­å°±æ— æ³•å»æ‰æ²¡ç”¨çš„ä»£ç **ï¼Œä»è€Œå¢å¤§äº†åŒ…çš„ä½“ç§¯ï¼Œå¾—ä¸å¿å¤±å•Š...ä¸€å®šè¦æ…ç”¨ï¼ï¼ï¼

> é…ç½® resolve.extensions å‡å°‘æ–‡ä»¶åç¼€ååŒ¹é…æµç¨‹

ç›¸ä¿¡å¾ˆå¤šç«¥é‹éƒ½å†™è¿‡ import MyComponent from 'components/MyComponent' è¿™æ ·ç±»ä¼¼è¯­å¥ï¼Œå¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¼•å…¥ç›¸åº”çš„ Vue ç»„ä»¶æˆ– React ç»„ä»¶ï¼Œéƒ½æ˜¯ä¸ä¼šåŠ å…¥ç›¸åº”çš„åç¼€åã€‚

çŸ¥é“ä¸ºå•¥ä¸ï¼Ÿ

é‚£æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œåœ¨ Webpack çš„ resolve.extensions ä¸­é…ç½®äº†ã€‚**åœ¨å¯¼å…¥è¯­å¥ä¸­æ²¡å¸¦æ–‡ä»¶åç¼€æ—¶ï¼Œé…ç½® resolve.extensions å¯è‡ªåŠ¨å¸¦ä¸Šåç¼€åè¯¢é—®ç›¸åº”æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤å€¼æ˜¯ ["js", "json"]ã€‚**

```javascript
resolve: {
  extensions: ["vue"]
}
```

**é…ç½® resolve.extensions å¯é’ˆå¯¹æ€§åœ°å‡å°‘æ–‡ä»¶åç¼€åçš„åŒ¹é…æµç¨‹ã€‚**

> é…ç½® module.noParse å¿½ç•¥å¯¹æœªé‡‡ç”¨æ¨¡å—åŒ–æ–‡ä»¶çš„é€’å½’è§£æå¤„ç†

å½¢å¦‚ jQueryã€ChartJS ç­‰æ¨¡å—éƒ½æ˜¯æœ¨æœ‰é‡‡ç”¨æ¨¡å—åŒ–æ ‡å‡†çš„ï¼Œå¦‚æœè¦è®© Webpack è§£æè¿™äº›æ–‡ä»¶å°†ä¼šè€—è´¹æ›´å¤šæ—¶é—´ã€‚

å†æ¯”å¦‚å‰é¢è®²åˆ°çš„ï¼Œä½¿ç”¨ vue.min.js æ–‡ä»¶ï¼Œç”±äº min.js æ–‡ä»¶æœªé‡‡ç”¨æ¨¡å—åŒ–æ ‡å‡†ï¼Œéƒ½æ˜¯åŒ…å«å…¨éƒ¨æºä»£ç çš„ã€‚**é€šè¿‡é…ç½® module.noParse å¯å¿½ç•¥å¯¹ vue.min.js æ–‡ä»¶çš„é€’å½’è§£æå¤„ç†ã€‚**

```javascript
module: {
  noParse: [/vue\min\.js$/],
}
```



## DllPluginæ„å»ºåŠ¨æ€é“¾æ¥åº“

åœ¨ window ç³»ç»Ÿä¼šç»å¸¸çœ‹åˆ° DLL åç¼€åæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å«åŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­ä¿å­˜ç€å…¶ä»–æ¨¡å—éœ€è°ƒç”¨çš„å‡½æ•°å’Œæ•°æ®ã€‚ï¼ˆè¿™å°±æœ‰ç‚¹åƒä¸€å¼ è¡¨ï¼Œè¡¨é‡Œé¢ä¿å­˜äº†å…¶ä»–æ¨¡å—éœ€è¦è°ƒç”¨çš„å‡½æ•°ä»¥åŠæ•°æ®å¯¹åº”çš„åœ°å€ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ï¼‰

è¦åœ¨é¡¹ç›®ä¸­æ¥å…¥åŠ¨æ€é“¾æ¥åº“çš„æ€æƒ³ï¼Œéœ€è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ã€‚

- å°†ç½‘é¡µä¾èµ–çš„åŸºç¡€æ¨¡å—æŠ½ç¦»å‡ºæ¥ï¼Œæ‰“åŒ…åˆ°ä¸€ä¸ªä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œåœ¨ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­å¯åŒ…å«å¤šä¸ªæ¨¡å—ã€‚
- å½“é‡åˆ°éœ€å¯¼å…¥çš„æ¨¡å—å­˜åœ¨äºæŸä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­æ—¶ï¼Œè¯¥æ¨¡å—å°†ä¸ä¼šå†è¢«æ‰“åŒ…ï¼Œè€Œæ˜¯ç›´æ¥åˆ°åŠ¨æ€é“¾æ¥åº“ä¸­è·å–ã€‚
- é¡µé¢ä¾èµ–çš„æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“éƒ½éœ€è¦è¢«åŠ è½½ã€‚

**åŠ¨æ€é“¾æ¥åº“åŠ å¿«æ„å»ºé€Ÿåº¦çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¤§é‡å¤ç”¨æ¨¡å—çš„åŠ¨æ€é“¾æ¥åº“åªéœ€è¦è¢«ç¼–è¯‘ä¸€æ¬¡ï¼Œåœ¨åé¢çš„æ„å»ºè¿‡ç¨‹ä¸­è¢«åŠ¨æ€é“¾æ¥åº“åŒ…å«çš„æ¨¡å—éƒ½ä¸ä¼šé‡æ–°ç¼–è¯‘ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç **ã€‚

**åŠ¨æ€é“¾æ¥åº“ä¸­å¸¸å¸¸åŒ…å«æœ€å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¦‚ reactã€react-dom ç­‰**ï¼Œæ‰€ä»¥åªè¦ä¸å‡çº§è¿™äº›æ¨¡å—çš„ç‰ˆæœ¬ï¼ŒåŠ¨æ€é“¾æ¥åº“å°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚

**åœ¨ Webpack ä¸­ï¼Œå·²ç»å†…ç½®æ”¯æŒå¯¹åŠ¨æ€é“¾æ¥åº“**ã€‚ä¸»è¦é€šè¿‡ä¸¤ä¸ªå†…ç½®æ’ä»¶æ¥å…¥ï¼Œåˆ†åˆ«æ˜¯

- DllPlugin æ’ä»¶ã€‚ç”¨äºæ‰“åŒ…å‡ºä¸€ä¸ªä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶
- DllReferencePlugin æ’ä»¶ã€‚ç”¨äºå‘Šè¯‰ Webpack ä½¿ç”¨äº†å“ªäº›åŠ¨æ€é“¾æ¥åº“ã€‚

ä»¥ React ä¸ºä¾‹ï¼Œåœ¨æ¥å…¥ DllPlugin åï¼Œæ„å»ºå‡ºæ¥çš„ç›®å½•ç»“æ„æ˜¯å¦‚ä¸‹ï¼š

```javascript
|-- main.js
|-- polyfill.dll.js // åŒ…å«æ‰€æœ‰ä¾èµ–çš„polyfillï¼Œå¦‚Promiseã€fetchç­‰API
|-- polyfill.manifest.json
|-- react.dll.js // åŒ…å«Reactçš„åŸºç¡€è¿è¡Œæ¨¡å—ï¼Œå¦‚reactå’Œreact-domæ¨¡å—
|-- react.manifest.json
```

dll.js æ–‡ä»¶ä¸­å…¶å®è•´å«ç€å¤§é‡æ¨¡å—çš„ä»£ç ï¼Œè¿™äº›**æ¨¡å—ä»£ç éƒ½è¢«æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç”¨æ•°ç»„çš„ç´¢å¼•ä½œä¸ºå…¶æ¨¡å—çš„ ID æ ‡è¯†ï¼Œé€šè¿‡ä¸€ä¸ª dll_ å‰ç¼€å˜é‡å…¨å±€æš´éœ²å‡ºæ¥**ï¼Œå³å¯ä»¥é€šè¿‡ window è¿›è¡Œè®¿é—®ï¼ˆå¦‚ window.dll_reactï¼‰ã€‚

è€Œ **manifest.json æ–‡ä»¶æ˜¯ç”± DllPlugin ç”Ÿæˆçš„ï¼Œæè¿°äº†ä¸å¯¹åº”çš„ dll.js æ–‡ä»¶ä¸­åŒ…å«å“ªäº›æ¨¡å—ä»¥åŠæ¯ä¸ªæ¨¡å—çš„è·¯å¾„å’ŒID**ã€‚

åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ç›¸å…³çš„æ–‡ä»¶éœ€è¦ä¸€ä»½ç‹¬ç«‹çš„æ„å»ºè¾“å‡ºï¼Œç”¨äºä¸»æ„å»ºä½¿ç”¨ã€‚æ–°å»ºä¸€ä¸ª webpack_dll.config.js æ–‡ä»¶

```javascript
// webpack_dll.config.js
const path = require('path')
const DllPlugin = reqiure('webpack/lib/DllPlugin')

module.exports = {
  entry: {
    react: ['react', 'react-dom'],
    polyfill: ['core-js/fn/object/assign', 'core-js/fn/promise', 'whatwg-fetch']
  },
  output: {
    filename: '[name].dll.js',
    path: path.resolve(__dirname, 'dist'),
    // å­˜æ”¾åŠ¨æ€é“¾æ¥åº“çš„å…¨å±€å˜é‡åç§°ï¼Œä¾‹å¦‚reactå°±æ˜¯_dll_react
    // åŠ ä¸Š_dll_æ˜¯ä¸ºäº†é˜²æ­¢å…¨å±€å˜é‡å†²çª
    library: '_dll_[name]'
  },
  plugins: [
    new Dllplugin({
      // åŠ¨æ€é“¾æ¥åº“çš„å…¨å±€å˜é‡åç§°ï¼Œéœ€å’Œoutput.libraryä¸­ä¿æŒä¸€è‡´
      // è¯¥å­—æ®µä¹Ÿæ˜¯è¾“å‡ºçš„manifest.jsonæ–‡ä»¶ä¸­nameå­—æ®µçš„å€¼ï¼Œå¦‚åœ¨react.manifest.jsonæ–‡ä»¶ä¸­å°±æœ‰name: "_dll_react"
      name: '_dll_[name]',
      // å®šä¹‰manifest.jsonæ–‡ä»¶è¾“å‡ºæ—¶çš„æ–‡ä»¶åç§°
      path: path.join(__dirname, 'dist', '[name].manifest.json')
    })
  ]
}
```

æ¥ä¸‹æ¥çœ‹çœ‹ï¼Œå¦‚ä½•åœ¨ä¸»æµç¨‹çš„ webpack.config.js ä¸­é…ç½®ã€‚

```javascript
// webpack.config.js
const path = require('path')
const DllReferencePlugin = require('webpack/lib/DllReferencePlugin')

module.exports = {
  entry: {
    main: './main.js'
  },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist')
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: ['babel-loader'],
        exclude: path.resolve(__dirname, 'node_modules')
      },
    ]
  },
  plugins: [
    // å‘Šè¯‰webpackä½¿ç”¨äº†å“ªäº›åŠ¨æ€é“¾æ¥åº“
    new DllReferencePlugin({
      manifest: require('./dist/react.manifest.json')
    }),
    new DllReferencePlugin({
      manifest: require('./dist/polyfill.manifest.json')
    })
  ]
}
```

åœ¨æ‰§è¡Œæ—¶ï¼Œå…ˆå°†åŠ¨æ€é“¾æ¥åº“ç›¸å…³æ–‡ä»¶ç¼–è¯‘å‡ºæ¥ï¼Œå› ä¸º Webpack é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ DllReferencePlugin ä¾èµ–è¿™äº›æ–‡ä»¶ã€‚å› æ­¤åœ¨æ‰§è¡Œæ„å»ºæ—¶æµç¨‹å¦‚ä¸‹ï¼š

- ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥åº“ç›¸å…³æ–‡ä»¶è¿˜æ²¡ç¼–è¯‘å‡ºæ¥ï¼Œéœ€æ‰§è¡Œ webpack --config webpack_dll.config.js å‘½ä»¤ï¼Œå…ˆç¼–è¯‘å¾—åˆ°åŠ¨æ€é“¾æ¥åº“ç›¸å…³æ–‡ä»¶ã€‚
- ç¬¬äºŒæ¬¡æ‰§è¡Œä»¥åï¼Œç”±äºåŠ¨æ€é“¾æ¥åº“ç›¸å…³æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå¯ç›´æ¥æ‰§è¡Œ webpack å‘½ä»¤è¿è¡Œé¡¹ç›®ã€‚ä¼šå‘ç°é¡¹ç›®æ„å»ºé€Ÿåº¦æ¯”ç¬¬ä¸€æ¬¡å¿«å¾ˆå¤šï¼Œå› ä¸ºåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶åªä¼šç¼–è¯‘ä¸€éã€‚



## HappyPackå¤šä¸ªè¿›ç¨‹å¤„ç†æ–‡ä»¶

**åœ¨ä½¿ç”¨ HappyPack æ—¶ï¼Œå¯è¿›è¡Œåˆ†è§£ä»»åŠ¡å’Œç®¡ç†çº¿ç¨‹**ã€‚å…ˆæ¥çœ‹çœ‹ webpack å¦‚ä½•æ¥å…¥ HappyPackã€‚

```javascript
const path = require('path')
const ExtractTextPlugin = require('extract-text-plugin')
const HappyPack = require('happypack')

module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        // å°†å¯¹.jsæ–‡ä»¶çš„å¤„ç†äº¤ç»™idä¸ºbabelçš„happypackå®ä¾‹
        use: ['happypack/loader?id=babel'],
        exclude: path.resolve(__dirname, 'dist', 'node_modules')
      },
      {
        test: /\.css$/,
        // å°†å¯¹.cssæ–‡ä»¶çš„å¤„ç†äº¤ç»™idä¸ºbabelçš„happypackå®ä¾‹
        use: ExtractTextPlugin.extract({
          use: ['happypack/loader?id=css']
        })
      }
    ]
  },
  plugins: [
    // åˆ›å»ºhappypackå®ä¾‹å¤„ç†ä»»åŠ¡
    new HappyPack({
      id: 'babel',
      loaders: ['babel-loader?cacheDirectory'],
      // ...å…¶ä»–é…ç½®é¡¹
    }),
    // åˆ›å»ºhappypackå®ä¾‹å¤„ç†ä»»åŠ¡
    new HappyPack({
      id: 'css',
      loaders: ['css-loader'],
      // ...å…¶ä»–é…ç½®é¡¹
    }),
    new ExtractTextPlugin({
      name: '[name].css'
    })
  ]
}
```

ä¸Šè¿°é…ç½®ä¸­ï¼Œæ‰€æœ‰æ–‡ä»¶çš„å¤„ç†éƒ½äº¤ç»™äº† happypack/loader ï¼Œæ ¹æ® id æ¥å‘Šè¯‰ happypack/loader é€‰æ‹©å“ªä¸ª happypack å®ä¾‹å¤„ç†æ–‡ä»¶ã€‚

å¦å¤–ï¼Œåœ¨ happypack å®ä¾‹ä¸­ï¼Œè¿˜æ”¯æŒä½¿ç”¨ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯

- threadsï¼šä»£è¡¨**å¼€å¯å‡ ä¸ªå­è¿›ç¨‹å¤„ç†**è¿™ç±»å‹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯3ä¸ªã€‚
- verboseï¼šæ˜¯å¦å…è®¸ä½¿ç”¨ happypack **è¾“å‡ºæ—¥å¿—**ï¼Œé»˜è®¤æ˜¯trueã€‚
- threadPoolï¼šä»£è¡¨å…±äº«è¿›ç¨‹æ± ï¼Œ**å¤šä¸ª Happypack å®ä¾‹éƒ½æ˜¯ä½¿ç”¨åŒä¸€ä¸ªå…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡**ï¼Œä»¥é˜²æ­¢èµ„æºå ç”¨è¿‡å¤šã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯æŒ‰å¦‚ä¸‹æ¥å…¥ happypackã€‚

```javascript
const happyThreadPool = HappyPack.ThreadPool({ size: 5 }) // æ„é€ å…±äº«è¿›ç¨‹æ± ï¼Œåœ¨è¿›ç¨‹æ± ä¸­åŒ…å«5ä¸ªå­è¿›ç¨‹

modules.export = {
  plugins: [
    // åˆ›å»ºhappypackå®ä¾‹å¤„ç†ä»»åŠ¡
    new HappyPack({
      id: 'babel',
      loaders: ['babel-loader?cacheDirectory'],
      // ...å…¶ä»–é…ç½®é¡¹
      threadPool: happyThreadPool
    }),
    // åˆ›å»ºhappypackå®ä¾‹å¤„ç†ä»»åŠ¡
    new HappyPack({
      id: 'css',
      loaders: ['css-loader'],
      // ...å…¶ä»–é…ç½®é¡¹
      threadPool: happyThreadPool
    }),
    new ExtractTextPlugin({
      name: '[name].css'
    })
  ]
}
```

åœ¨ä½¿ç”¨ HappyPack å‰ï¼Œéœ€å¦‚ä¸‹å®‰è£…ï¼š

```javascript
npm i -D happypack
```

**åœ¨ webpack æ„å»ºæµç¨‹ä¸­ï¼Œä½¿ç”¨ loader å¯¹æ–‡ä»¶çš„è½¬æ¢æ“ä½œæ— ç–‘æ˜¯æœ€è€—æ—¶çš„æµç¨‹**ã€‚

HappyPack æ ¸å¿ƒåŸç†å°±æ˜¯**å°† loader å¯¹æ–‡ä»¶çš„è½¬æ¢æ“ä½œåˆ†è§£åˆ°å¤šä¸ªè¿›ç¨‹ä¸­å»å¹¶è¡Œå¤„ç†ï¼Œä»è€Œå‡å°‘æ„å»ºæ—¶é—´**ã€‚

å®ä¾‹åŒ– HappyPack æ—¶ï¼Œå…¶å®å°±æ˜¯å‘Šè¯‰ HappyPack æ ¸å¿ƒè°ƒåº¦å™¨é€šè¿‡ä¸€ç³»åˆ— loader å»è½¬æ¢ä¸€ç±»æ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‡å®šå¦‚ä½•ä¸ºè¯¥ç±»æ–‡ä»¶è½¬æ¢æ“ä½œåˆ†é…å­è¿›ç¨‹ã€‚**åœ¨æ‰§è¡Œ webpack æ—¶ï¼Œæ ¸å¿ƒè°ƒåº¦å™¨ä¼šå°†ä¸€ä¸ªä¸ªä»»åŠ¡åˆ†é…ç»™å½“å‰ç©ºé—²å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å¤„ç†å®Œæ¯•å°±ä¼šå°†ç»“æœå‘é€ç»™æ ¸å¿ƒè°ƒåº¦å™¨ï¼Œå®ƒä»¬é—´çš„æ•°æ®äº¤æ¢å°±æ˜¯é€šè¿‡è¿›ç¨‹é—´çš„é€šä¿¡ API å®ç°çš„**ã€‚



## ParalleUglifyPluginå¤šä¸ªè¿›ç¨‹å‹ç¼©æ–‡ä»¶

åœ¨å‘ç”Ÿäº§æ—¶ï¼Œæˆ‘ä»¬éƒ½ç»å¸¸ä½¿ç”¨ uglifyJS å¯¹æºä»£ç è¿›è¡Œå‹ç¼©å¤„ç†ã€‚åœ¨å‹ç¼©ä»£ç è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…ˆå°† js ä»£ç è§£ææˆæŠ½è±¡è¯­æ³•æ ‘ ASTï¼Œæ¥ç€å†å»åº”ç”¨å„ç§è§„åˆ™åˆ†æå’Œå¤„ç† ASTï¼Œè¿™è¿‡ç¨‹è®¡ç®—é‡å¯è°“æ˜¯å·¨å¤§çš„ï¼Œè€—æ—¶ç‰¹åˆ«å¤§ã€‚

**ä½¿ç”¨ uglifyJS ä¼šå¯¹æ–‡ä»¶è¿›è¡Œä¸€ä¸ªä¸€ä¸ªçš„å‹ç¼©ï¼Œå¹¶ä¸ä¼šå¹¶è¡Œå¤„ç†ï¼Œè¿™æ— ç–‘æ˜¯è€—æ—¶æœ€å¤§çš„**ã€‚å€Ÿé‰´äº HappyPack å¤šè¿›ç¨‹åˆ†é…ä»»åŠ¡ä¼˜ç‚¹ï¼Œ**ä½¿ç”¨ ParalleUglifyPlugin å¯ä»¥å¼€å¯å¤šä¸ªå­è¿›ç¨‹ï¼Œå°†å¯¹å¤šä¸ªæ–‡ä»¶çš„å‹ç¼©å·¥ä½œåˆ†é…ç»™å¤šä¸ªå­è¿›ç¨‹å®Œæˆï¼Œæ¯ä¸ªå­è¿›ç¨‹å…¶å®éƒ½æ˜¯ä½¿ç”¨ uglifyJS è¿›è¡Œå‹ç¼©ï¼Œä½†æ˜¯åŒºåˆ«å°±æ˜¯å¹¶è¡Œå¤„ç†**ã€‚

```javascript
const ParalleUglifyPlugin = require('webpack-parallel-uglify-plugin')

module.exports = {
  plugins: [
    // ä½¿ç”¨ParallelUglifyPluginå¹¶è¡Œå‹ç¼©è¾“å‡ºJavascriptä»£ç 
    new ParallelUglifyPlugin({
      // ä¼ é€’ç»™uglifyJSçš„å‚æ•°
      uglifyJS: {
        output: {
          // ç´§å‡‘è¾“å‡º
          beautify: false,
          // åˆ é™¤æ‰€æœ‰æ³¨é‡Š
          comments: false
        },
        compress: {
          // åœ¨UglifyJsåˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç æ—¶ä¸è¾“å‡ºè­¦å‘Š
					warnings: false,
          // åˆ é™¤æ‰€æœ‰çš„consoleè¯­å¥ï¼Œå¯å…¼å®¹IEæµè§ˆå™¨
          drop_console: true,
          // å†…åµŒå·²å®šä¹‰ä½†æ˜¯åªç”¨åˆ°ä¸€æ¬¡çš„å˜é‡
          collapse_vars: true
        }
      }
    })
  ]
}
```

å½“ç„¶ ParalleUglifyPlugin è¿˜æ”¯æŒå…¶å®ƒå‚æ•°ï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œå¯è‡ªè¡Œè§‚å¯Ÿå…¶å®˜æ–¹æ–‡æ¡£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**ParalleUglifyPlugin åŒæ—¶å†…ç½®äº† UglifyJS å’Œ UglifyESï¼ŒUglifyES å¯å¹¶è¡Œå‹ç¼© ES6 ä»£ç **ã€‚

åœ¨ä½¿ç”¨ ParalleUglifyPlugin æ—¶ï¼Œéœ€å®‰è£…ï¼š

```javascript
npm i -D ParalleUglifyPlugin
```



