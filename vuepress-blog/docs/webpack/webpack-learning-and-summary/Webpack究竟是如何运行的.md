# Webpack ç©¶ç«Ÿæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ

åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦ç»å¸¸å°†å¿ƒæ€æ”¾åœ¨å¦‚ä½•ä½¿ç”¨ Webpack ä¼˜åŒ–å¼€å‘ä½“éªŒä»¥åŠè¾“å‡ºçš„è´¨é‡ï¼Œå´å¾ˆå°‘æŠŠç›®å…‰æ”¾åœ¨ Webpack çš„å¯åŠ¨æµç¨‹ã€loader å’Œ plugin åŸºæœ¬åŸç†ç­‰ç­‰æ–¹é¢ä¸Šã€‚

é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥ä¸€èµ·æ¥ç®€å•ç¼•ä¸€ç¼•ï¼Œç©¶ç«Ÿ Webpack æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Ÿä»¥åŠ loader å’Œ plugin åˆæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ


## ç°ä»£æ„å»ºå·¥å…·å¯¹æ¯”

åœ¨æ¢ç©¶ä¹‹å‰ï¼Œæˆ‘ä¸ªäººè§‰å¾—æ˜¯å¾ˆæœ‰å¿…è¦è¯´ä¸€è¯´çš„ï¼Œé‚£å°±æ˜¯ç°ä»£æ„å»ºå·¥å¯¹æ¯”ã€‚ä¸ºä»€ä¹ˆï¼Ÿ

åœ¨å‰ç«¯å¿«é€Ÿå‘å±•çš„è¿™å‡ å¹´ï¼Œå¦‚ä½•é«˜æ•ˆæ»´æ„å»ºé¡¹ç›®å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œä½†æ˜¯åœ¨ç™¾èŠ±äº‰è‰³çš„æ„å»ºå·¥å…·é‡Œé¢ï¼Œç©¶ç«Ÿæ˜¯é€‰ç”¨å“ªä¸€æ¬¾ï¼Ÿé‚£ä¹ˆç°ä»£æ„å»ºå·¥å…·æœ‰é‚£ä¹ˆå¤šï¼Œè‚¯å®šå¾—æœ‰å®ƒä»¬é€‚ç”¨åœºåˆï¼Œå› æ­¤äº†è§£å®ƒä»¬ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ğŸ¤”

ä»Šå¤©è¦è®²çš„ç°ä»£å·¥å…·ï¼Œä¸»è¦æ˜¯ **NPM Scriptã€Gruntã€Glupã€Fis3ã€Webpackã€Rollup**ã€‚ä¸‹é¢æˆ‘å°±æ¥çœ‹çœ‹å®ƒä»¬ç©¶ç«Ÿæ˜¯ç”¨æ¥å¹²å•¥çš„ã€‚

> NPM Script

å¦‚æœä½ ç”¨è¿‡ package.jsonï¼Œé‚£ä¹ˆä½ å¯¹å®ƒè‚¯å®šä¸é™Œç”Ÿã€‚**NPM Script æ˜¯ NPM å†…ç½®çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸åœ¨ package.json æ–‡ä»¶é‡Œé¢ä½¿ç”¨ scripts å­—æ®µå®šä¹‰çš„ä»»åŠ¡**ã€‚ä¸¾ä¸ªğŸŒ°ï¼š

```javascript
{
  "scripts": {
    "start": "node main.js",
 		"prod": "node prod.js"
  }
}
```

åœ¨å®šä¹‰ä¸Šè¿°çš„ä»»åŠ¡åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®æ ¹è·¯å¾„ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```javascript
npm start
```

**æ‰§è¡Œ NPM ç›¸åº”çš„å‘½ä»¤åï¼Œä¼šæ ¹æ® package.json æ‰§è¡Œå‘½ä»¤å¯¹åº”çš„ä»»åŠ¡**ã€‚

æ¯«æ— ç–‘é—®ï¼Œ**NPM Script çš„ä¼˜ç‚¹å°±æ˜¯å†…ç½®ï¼Œæ— éœ€å®‰è£…å…¶ä»–ä¾èµ–ï¼Œç¼ºç‚¹å°±æ˜¯åŠŸèƒ½å¤ªç®€å•ï¼Œä¸èƒ½æ–¹ä¾¿æ»´ç®¡ç†å¤šä¸ªä»»åŠ¡ä¹‹é—´çš„ä¾èµ–**ã€‚

> Grunt

Grunt å’Œ NPM Script ä¸€æ ·ï¼Œéƒ½åªæ˜¯ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œè€…ã€‚ä½†ç›¸æ¯”ä¹‹ä¸‹ï¼Œ**Grunt æœ‰ç€å¤§é‡ç°æˆçš„æ’ä»¶å°è£…äº†å¸¸è§çš„ä»»åŠ¡ï¼Œä¹Ÿèƒ½ç®¡ç†ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶èƒ½è‡ªåŠ¨åŒ–æ»´æ‰§è¡Œä¾èµ–çš„ä»»åŠ¡**ï¼Œæ¯ä¸ªä»»åŠ¡çš„å…·ä½“ä»£ç å’Œä¾èµ–å…³ç³»å†™åœ¨ Gruntfile.js é‡Œã€‚

```js
module.exports = function(grunt) {

  // Project configuration.
  grunt.initConfig({
    pkg: grunt.file.readJSON('package.json'),
    uglify: {
      options: {
        banner: '/*! <%= pkg.name %> <%= grunt.template.today("yyyy-mm-dd") %> */\n'
      },
      build: {
        src: 'src/<%= pkg.name %>.js',
        dest: 'build/<%= pkg.name %>.min.js'
      }
    }
  });

  // Load the plugin that provides the "uglify" task.
  grunt.loadNpmTasks('grunt-contrib-uglify');

  // Default task(s).
  grunt.registerTask('default', ['uglify']);

};
```

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤ gruntï¼Œå°±ä¼šå¯åŠ¨ uglify åŠŸèƒ½å¯¹æŒ‡å®šçš„ JavaScript æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä¸Šè¿°é…ç½®ä¸­è¿˜ä»æºæ–‡ä»¶ package.json ä¸­è¯»å–ä¿¡æ¯ã€‚

**Grunt æœ€å¤§çš„ä¼˜ç‚¹åœ¨äºèƒ½å¤Ÿé€šè¿‡å¤§é‡ç°æˆæ’ä»¶è¿›è¡ŒåŠŸèƒ½çš„æ‹“å±•ï¼Œç¼ºç‚¹å°±æ˜¯é›†æˆåº¦ä¸é«˜ï¼Œå‡ ä¹éƒ½æ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ— æ³•åšåˆ°å¼€ç®±å³ç”¨ã€‚**

Grunt ç›¸å½“äºæ˜¯ NPM Script çš„è¿›åŒ–ç‰ˆï¼Œå®ƒçš„è¯ç”Ÿå°±æ˜¯å¼¥è¡¥ NPM Script çš„ä¸è¶³ã€‚

> Gulp

Glup æ˜¯ä¸€ä¸ªåŸºäºæµçš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚é™¤äº†å¯ä»¥ç®¡ç†å’Œæ‰§è¡Œä»»åŠ¡ï¼Œè¿˜æ”¯æŒç›‘å¬æ–‡ä»¶ã€è¯»å†™æ–‡ä»¶ã€‚

```javascript
const { src, dest } = require('gulp');
const babel = require('gulp-babel');

exports.default = function() {
  return src('src/*.js')
    .pipe(babel())
    .pipe(dest('output/'));
}
```

ä¸Šè¿°æ —å­ä¸­ï¼Œé€šè¿‡è¯»å– src ç›®å½•ä¸‹çš„æ‰€æœ‰ js æ–‡ä»¶ï¼Œé€šè¿‡ babel æ’ä»¶è½¬æ¢åï¼Œç„¶åå†™å…¥åˆ° output ç›®å½•ä¸‹ã€‚

**Gulp çš„ä¼˜ç‚¹å°±æ˜¯å¼•å…¥äº†æµçš„æ¦‚å¿µï¼Œå¯ä»¥æ›´å¥½æ”¯æŒè¯»å†™æ–‡ä»¶ä»¥åŠç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œç¼ºç‚¹å’Œ Grunt ä¸€æ ·ï¼Œé›†æˆåº¦ä¾ç„¶ä¸é«˜ï¼Œéƒ½æ˜¯éœ€è¦ç¬¬ä¸‰æ–¹æ’ä»¶å®Œæˆå¤§éƒ¨åˆ†åŠŸèƒ½**ã€‚

Glup å¯ä»¥çœ‹æˆæ˜¯ Grunt çš„åŠ å¼ºç‰ˆï¼Œç›¸æ¯”äº Gruntï¼ŒGlup å¢åŠ äº†ç›‘å¬æ–‡ä»¶ã€è¯»å†™æ–‡ä»¶ã€æµå¼å¤„ç†çš„åŠŸèƒ½ã€‚

> Fis3

Fis3 æ˜¯ä¸€æ¬¾æ¥è‡ªç™¾åº¦çš„ä¼˜ç§€å›½äº§æ„å»ºå·¥å…·ã€‚ç›¸æ¯” Grunt å’Œ Glupï¼Œå®ƒé›†æˆäº† Web å¼€å‘ä¸­çš„å¸¸ç”¨åŠŸèƒ½ï¼Œä¸»è¦åŒ…å«å¦‚ä¸‹ï¼š

- è¯»å†™æ–‡ä»¶ã€‚é€šè¿‡ fis.match è¯»æ–‡ä»¶
- èµ„æºå®šä½ã€‚è§£ææ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»
- æ–‡ä»¶ç¼“å­˜ã€‚é€šè¿‡ useHash é…ç½®è¾“å‡ºæ–‡ä»¶æ—¶ä¸ºæ–‡ä»¶ URL åŠ ä¸Š md5 æˆ³ï¼Œä»¥ä¼˜åŒ–æµè§ˆå™¨çš„ç¼“å­˜
- æ–‡ä»¶ç¼–è¯‘ã€‚é€šè¿‡ parser é…ç½®æ–‡ä»¶è§£æå™¨æ¥å®Œæˆæ–‡ä»¶è½¬æ¢ï¼Œå¦‚ ES6 è½¬æ¢æˆ ES5ã€‚
- å‹ç¼©èµ„æºã€‚é€šè¿‡ optimizer é…ç½®ä»£ç å‹ç¼©æ–¹æ³•ã€‚
- å›¾ç‰‡åˆå¹¶ã€‚é€šè¿‡ spriter é…ç½®åˆå¹¶ CSS é‡Œå¯¼å…¥çš„å›¾ç‰‡åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä»è€Œå‡å°‘ HTTP è¯·æ±‚ã€‚

```javascript
fis.match('*.{js, css, png}', { // ä¸ºæ–‡ä»¶æ·»åŠ md5
  useHash: true
})
fis.match('*.ts', { // è½¬åŒ–tsæ–‡ä»¶
  parser: fis.plugin('typescript')
})
```

**Fis3 çš„ä¼˜ç‚¹æ˜¯é›†æˆäº†å„ç§ Web å¼€å‘æ‰€éœ€çš„æ„å»ºåŠŸèƒ½ï¼Œé…ç½®ç®€å•å¹¶ä¸”å¼€ç®±å³ç”¨ã€‚ç¼ºç‚¹å°±æ˜¯å®˜æ–¹ç›®å‰ä¸å†è¿›è¡Œæ›´æ–°å’Œç»´æŠ¤ï¼Œä¹Ÿä¸æ”¯æŒæœ€æ–°ç‰ˆçš„ Node.js**ã€‚

Fis3 ç›¸æ¯” Grunt å’Œ Glup æ„å»ºå·¥å…·æ¥è¯´ï¼Œè¿›ä¸€æ­¥åŠ å¼ºäº†é›†æˆåŠŸèƒ½ï¼Œå¦‚æœå°† Gruntã€Glup æ¯”ä½œæ±½è½¦çš„å‘åŠ¨æœºè¯ï¼Œåˆ™å¯ä»¥å°† Fis3 æ¯”ä½œä¸€è¾†å®Œæ•´çš„æ±½è½¦ã€‚

> Webpack

ä½œä¸ºä»Šå¤©çš„ä¸»è§’â€”â€”Webpackï¼Œå¯ä»¥è¯´æ˜¯ç›®å‰é›†æˆåŠŸèƒ½æœ€å…¨ã€ä½¿ç”¨æœ€å¹¿æ³›çš„æ„å»ºå·¥å…·ã€‚

Webpack æ˜¯ä¸€ä¸ª JavaScript æ‰“åŒ…æ¨¡å—åŒ–çš„å·¥å…·ï¼Œ**åœ¨ Webpacké‡Œä¸€åˆ‡æ–‡ä»¶çš†æ¨¡å—ï¼Œé€šè¿‡ Loader è½¬æ¢æ–‡ä»¶ï¼Œé€šè¿‡ Plugin æ³¨å…¥äº‹ä»¶é’©å­ï¼Œæœ€åè¾“å‡ºç”±å¤šä¸ªæ¨¡å—ç»„åˆæˆ Chunk å¹¶è½¬æ¢æˆç›¸åº”çš„æ–‡ä»¶è¿›è¡Œè¾“å‡º**ã€‚

```javascript
module.exports = {
	entry: './main.js',
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, './dist')
  }
}
```

**Webpack çš„ä¼˜ç‚¹åœ¨äºä¸“æ³¨å¤„ç†æ¨¡å—åŒ–åŠŸèƒ½ï¼Œèƒ½åšåˆ°å¼€ç®±å³ç”¨ã€ä¸€æ­¥åˆ°ä½ï¼Œèƒ½é€šè¿‡ Plugin è¿›è¡Œæ‰©å±•ï¼Œå¹¶ä¸”ç¤¾åŒºä¹Ÿæ´»è·ƒã€‚ç¼ºç‚¹å°±æ˜¯åªèƒ½ç”¨äºæ¨¡å—åŒ–å¼€å‘çš„é¡¹ç›®ï¼ˆå…¶å®è¿™ä¹Ÿä¸ç®—æ˜¯ç¼ºç‚¹ï¼Œä¸ªäººè§‰å¾—ï¼‰**ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼Œwebpack å¯ä»¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„é›†æˆåº¦ã€å®Œå–„çš„ç¬¬ä¸‰æ–¹æ’ä»¶ç®¡ç†å’Œç¤¾åŒºæ´»è·ƒçš„æ¨¡å—åŒ–æ„å»ºå·¥å…·ã€‚

> Rollup

Rollup æ˜¯ä¸€ä¸ªå’Œ Webpack å¾ˆç±»ä¼¼ä½†ä¸“æ³¨äº ES6 çš„æ¨¡å—æ‰“åŒ…å·¥å…·ã€‚å®ƒçš„äº®ç‚¹åœ¨äºèƒ½å¤Ÿé’ˆå¯¹ ES6 æºç è¿›è¡Œ Tree Shaking ä»¥åŠå¯¹æ²¡ç”¨çš„ä»£ç è¿›è¡Œ Scope Hoistingï¼Œä»è€Œä¼˜åŒ–è¾“å‡ºè´¨é‡ã€‚å½“ç„¶ï¼ŒWebpack ä¹Ÿåœ¨å†…éƒ¨å®ç°è¿™äº›åŠŸèƒ½ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼ŒRollup åœ¨ç”¨äºæ‰“åŒ… JavaScript åº“æ—¶æ¯” Webpack æ›´æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºå…¶æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶æ›´å°ã€‚ä½†å®ƒçš„ç¼ºç‚¹å°±æ˜¯è¿˜ä¸å¤Ÿå®Œå–„ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹è¿˜æ‰¾ä¸åˆ°ç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚



## Webpackæ„å»ºæµç¨‹

è¦äº†è§£ Webpack æ˜¯æ€ä¹ˆè¿›è¡Œæ„å»ºçš„ï¼Œé¦–å…ˆå¾—ä¸‹åˆ—å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µè¿›è¡Œå…¥æ‰‹ã€‚

- Entryï¼šWebpack æ„å»ºçš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥é…ç½®ã€‚
- Outputï¼šWebpack æ„å»ºçš„è¾“å‡ºé…ç½®ã€‚
- Moduleï¼šæ¨¡å—é…ç½®ï¼Œä¸€åˆ‡æ–‡ä»¶éƒ½æ˜¯æ¨¡å—ï¼Œä¸€ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ã€‚
- Chunkï¼šä»£ç å—ï¼Œä¸€ä¸ªä»£ç å—ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—æ„æˆï¼Œç”¨äºä»£ç åˆå¹¶å’Œåˆ†å‰²ã€‚
- Loaderï¼šæ¨¡å—è½¬æ¢å™¨ï¼Œç”¨äºå°†æ¨¡å—çš„åŸå†…å®¹è½¬æ¢æˆæ–°å†…å®¹ã€‚
- Pluginï¼šæ’ä»¶æ‰©å±•åŠŸèƒ½å™¨ï¼Œç”¨äºç›‘å¬Webpackåœ¨ç”Ÿå‘½å‘¨æœŸå†…å¹¿æ’­äº‹ä»¶æ—¶æ‰§è¡Œç›¸åº”çš„å›è°ƒé€»è¾‘ã€‚

é‚£ä¹ˆï¼ŒWebpack çš„æ„å»ºæµç¨‹æ˜¯å¦‚ä½•çš„å‘¢ï¼Ÿ

**å…¶å® Webpack çš„æ„å»ºæµç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯åˆå§‹åŒ–é˜¶æ®µã€ç¼–è¯‘é˜¶æ®µã€è¾“å‡ºé˜¶æ®µ**ã€‚ä¸‹é¢å°±ç®€å•æ€»ç»“ä¸€ä¸‹ã€‚

1. åˆå§‹åŒ–é˜¶æ®µ

   é¦–å…ˆä¼šåˆå§‹åŒ–å‚æ•°ï¼ˆshellè„šæœ¬ä¸­å‚æ•°å’Œé…ç½®ä¸­å‚æ•°åˆå¹¶ï¼‰ï¼Œæ ¹æ®å‚æ•°åˆå§‹åŒ– compiler ç¼–è¯‘å¯¹è±¡ï¼Œæ¥ç€å°±æ˜¯åŠ è½½é…ç½®é¡¹é‡Œçš„æ’ä»¶ï¼ˆåˆ›å»ºç›¸åº”æ’ä»¶å®ä¾‹ï¼Œå¼€å§‹ç›‘å¬ Webpack å£°æ˜å‘¨æœŸä¸­çš„å¹¿æ’­äº‹ä»¶ï¼‰ã€‚

2. ç¼–è¯‘é˜¶æ®µ

   å°†åˆå§‹åŒ–é˜¶æ®µå¾—åˆ°çš„ compiler ç¼–è¯‘å¯¹è±¡ï¼Œæ‰§è¡Œ run æ–¹æ³•æ­£å¼å¼€å§‹è¿›è¡Œç¼–è¯‘ã€‚

   é¦–å…ˆä¼šä»é…ç½®é¡¹é‡Œçš„ Entry å…¥æ‰‹ï¼Œæ‰¾åˆ°æ‰€æœ‰çš„å…¥å£æ¨¡å—ã€‚

   æ¥ç€ä»å…¥å£æ¨¡å—å¼€å§‹é€’å½’å¯»æ‰¾ï¼Œå°†åŒ¹é…åˆ°çš„æ¨¡å—ä½¿ç”¨ç›¸åº”çš„ Loader è¿›è¡Œè½¬æ¢ï¼Œé‡å¤è¯¥è¿‡ç¨‹ç›´åˆ°æ‰€æœ‰çš„ä¾èµ–æ¨¡å—å¯»æ‰¾å®Œä¸ºæ­¢ã€‚

   æœ€åï¼Œç¼–è¯‘ç»“æŸåå°†å¾—åˆ°æ‰€æœ‰è½¬æ¢å¥½çš„æ¨¡å—ä»¥åŠå„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

3. è¾“å‡ºé˜¶æ®µ

   æ ¹æ®ç¼–è¯‘é˜¶æ®µå¾—åˆ°çš„å„ä¸ªæ¨¡å—é—´ä¾èµ–å…³ç³»ï¼Œå°†ä¸€ä¸ªä¸ªæ¨¡å—å¼€å§‹ç»„åˆæˆä¸€ä¸ª Chunkï¼Œå¹¶å°† Chunk è½¬æ¢æ–‡ä»¶ï¼Œæœ€ç»ˆå°†æ–‡ä»¶è¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚

åœ¨äº†è§£å®Œ Webpack çš„æ„å»ºæµç¨‹åï¼Œæˆ‘ç›¸ä¿¡ä½ è‚¯å®šå’Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼Œé‚£å°±æ˜¯**ä¸ºä»€ä¹ˆä¸ç›´æ¥å°†è½¬æ¢å¥½çš„æ¨¡å—ç›´æ¥è½¬å˜æˆæ–‡ä»¶è¾“å‡ºï¼Ÿè€Œæ˜¯å°†å¤šä¸ªæ¨¡å—æ ¹æ®ä¾èµ–å…³ç³»ç»„æˆ Chunk å¹¶è½¬å˜æˆæ–‡ä»¶å†è¾“å‡ºï¼Ÿ**

**å…¶å®ç»„æˆä¸€ä¸ª Chunk æ˜¯æœ‰ç›®çš„çš„ï¼Œå°±æ˜¯ä¸ºäº†å‡å°‘ç½‘ç»œè¯·æ±‚**ã€‚å¦‚æœä»…ä»…æ˜¯æŠŠè½¬æ¢å¥½çš„æ¨¡å—è½¬å˜æˆæ–‡ä»¶æ¥è¾“å‡ºï¼Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨ä¸­ï¼Œè®¿é—®ä¸€ä¸ªæ¨¡å—æ–‡ä»¶æ—¶ï¼Œå½“å‘ç°å®ƒè¿˜æœ‰ä¾èµ–çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡ç½‘ç»œè¯·æ±‚ç›¸åº”çš„ä¾èµ–æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸å¾—ä¸è€—è´¹æ—¶é—´åœ¨ç½‘ç»œè¯·æ±‚ä¸Šã€‚å¦å¤–æµè§ˆå™¨ç¯å¢ƒä¸åƒ Nodejs é‚£æ ·èƒ½å¤Ÿå¿«é€Ÿæ»´ä»æœ¬åœ°åŠ è½½ä¸€ä¸ªæ¨¡å—æ–‡ä»¶ï¼Œå› æ­¤æ ¹æ®ä¾èµ–å…³ç³»ç»„è£…æˆä¸€ä¸ª Chunk å¹¶è½¬æ¢æˆæ–‡ä»¶åï¼Œå°†å¤§å¤§å‡å°‘å¯¹ç½‘ç»œçš„ä¾èµ–ç¨‹åº¦ã€‚



## ç†è§£ Loader

Loader å°±åƒä¸€ä¸ªç¿»è¯‘å‘˜ï¼Œèƒ½å°†æºæ–‡ä»¶ç»è¿‡è½¬æ¢åè¾“å‡ºæ–°çš„å†…å®¹ï¼Œå¹¶ä¸”ä¸€ä¸ªæ–‡ä»¶è¿˜èƒ½ç»è¿‡é“¾å¼çš„ Loader å¤„ç†ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šå…ˆæä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¸¸é—®çš„ï¼Œå¤šä¸ª Loader çš„æ‰§è¡Œé¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

å…¶å®ï¼Œ**Loader çš„æ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦çš„**ã€‚Webpack æ˜¯ç”±äºè·Ÿéšå‡½æ•°å¼ç¼–ç¨‹çš„ç¼˜æ•…ï¼Œæ‰ä¼šé‡‡å–äº†ä»å³åˆ°å·¦çš„é¡ºåºæ‰§è¡Œ Loaderã€‚

**Webpack å®ç° Loader æ‰§è¡Œé€‰æ‹©å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ compose æ–¹å¼ï¼Œè€Œä¸æ˜¯é€‰æ‹© pipe æ–¹å¼**ï¼ˆpipe æ–¹å¼å®ç°çš„æ˜¯ä»å·¦åˆ°å³ï¼Œå¦‚æœè¦å®ç°ä»å·¦åˆ°å³ä¹Ÿä¸éš¾ï¼‰ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå®ç°æ–¹å¼éƒ½æ˜¯ä»å³åˆ°å·¦çš„ï¼Œçœ‹ä¸ªğŸŒ°ï¼š

```javascript
// æ‘˜è‡ªç½‘ä¸Šä¾‹å­
const compose = (...fns) => x => fns.reduceRight((v, f) => f(v), x);
const add1 = n => n + 1; //åŠ 1
const double = n => n * 2; // ä¹˜2
const add1ThenDouble = compose(
  double,
  add1
);
add1ThenDouble(2); // 6
// ((2 + 1 = 3) * 2 = 6) 
```

ä¸€ä¸ª Loader å°±æ˜¯ä¸€ä¸ª Node.js æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—éœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°ã€‚å¯¼å‡ºå‡½æ•°çš„å·¥ä½œå°±æ˜¯è·å¾—å¤„ç†å‰çš„åŸå†…å®¹ï¼Œå¯¹åŸå†…å®¹æ‰§è¡Œå¤„ç†åè¿”å›å¤„ç†åçš„å†…å®¹ã€‚

é‚£ä¹ˆ**å¦‚æœè¦ç¼–å†™ä¸€ä¸ªç®€å•çš„ Loader ï¼Œéœ€è¦æ€æ ·å­æ“ä½œå‘¢ï¼Ÿ**

ç”±äº Loader æ˜¯è¿è¡Œåœ¨ Node.js ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„çš„ Node.js è‡ªå¸¦çš„ APIï¼Œæˆ–è€…å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—è¿›è¡Œè°ƒç”¨ï¼Œå…ˆçœ‹ä¸ªæœ€ç®€å•çš„ç¼–å†™æ —å­ï¼š

```javascript
const sass = require('node-sass')
module.exports = function(source) {
  return sass(source)
}
```

å¦å¤–ï¼ŒWebpack è¿˜æä¾›äº†ä¸€äº› API ä¾› Loader è°ƒç”¨ï¼Œç®€å•åˆ—ä¸¾ä¸€ä¸‹å¸¸ç”¨çš„ APIã€‚

- this.callbackã€‚ç”¨äº webpack å’Œ loader é—´çš„é€šä¿¡ï¼Œåœ¨ loader ä½¿ç”¨æ—¶ï¼Œå‘Šè¯‰ webpack è¿”å›ç»“æœã€‚
- this.contextã€‚å‡å¦‚å½“å‰ loader å¤„ç†çš„æ–‡ä»¶æ˜¯ \/src\/main\.js ï¼Œåˆ™ this.context ç­‰äº \/srcã€‚
- this.resourceã€‚å½“å‰å¤„ç†æ–‡ä»¶çš„å®Œæ•´è¯·æ±‚è·¯å¾„ã€‚
- this.resourceQueryã€‚å½“å‰å¤„ç†æ–‡ä»¶çš„ queryStringã€‚
- this.tragetã€‚ç›¸å½“äº Webpack é…ç½®ä¸­çš„ Targetã€‚
- this.emitFileã€‚è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚
- this.clearDependciesã€‚æ¸…é™¤å½“å‰æ­£åœ¨å¤„ç†æ–‡ä»¶çš„æ‰€æœ‰ä¾èµ–ã€‚
- this.addDependciesã€‚å½“å‰å¤„ç†æ–‡ä»¶æ·»åŠ å…¶ä¾èµ–çš„æ–‡ä»¶ã€‚

é‚£ä¹ˆç¼–å†™å®Œ Loader åï¼Œå¦‚ä½•è®© Webpack åŠ è½½æœ¬åœ° Loaderï¼Ÿ

1. NPM link

   NPM link ä¸“é—¨ç”¨äºå¼€å‘å’Œè°ƒè¯•æœ¬åœ°çš„ NPM æ¨¡å—çš„ï¼Œèƒ½åšåˆ°ä¸å‘å¸ƒæ¨¡ç‰ˆçš„æƒ…å†µä¸‹ï¼Œå°†æœ¬åœ°çš„ä¸€ä¸ªæ­£åœ¨å¼€å‘çš„æ¨¡ç‰ˆçš„æºç é“¾æ¥åˆ°é¡¹ç›® node_modules ç›®å½•ä¸‹ï¼Œè®©é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„ NPM æ¨¡å—ã€‚

   è¦å®Œæˆ NPM çš„æ­¥éª¤ï¼Œéœ€æŒ‰ä»¥ä¸‹å®ç°ï¼š

   - ç¡®ä¿åœ¨æœ¬åœ°å¼€å‘å¥½ NPM æ¨¡å—ä¸­ package.json å·²ç»é…ç½®å¥½ã€‚
   - åœ¨æœ¬åœ°çš„ NPM æ¨¡å—ç›®å½•ä¸‹æ‰§è¡Œ npm link å‘½ä»¤ï¼Œå°†æœ¬åœ°æ¨¡å—æ³¨å†Œåˆ°å…¨å±€ã€‚
   - åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ npm link loader-nameï¼Œå°†ç¬¬äºŒæ­¥æ³¨å†Œåˆ°å…¨å±€çš„æœ¬åœ° NPM æ¨¡å—é“¾æ¥åˆ°é¡¹ç›®çš„ node_modules ä¸‹ï¼Œå…¶ä¸­ loader-name æ˜¯æŒ‡åœ¨ç¬¬ä¸€æ­¥çš„ package.json æ–‡ä»¶ä¸­é…ç½®çš„æ¨¡å—åç§°ã€‚

2. ResolveLoader

   ä¸ºäº†è®© Webpack åŠ è½½æ”¾åœ¨æœ¬åœ°çš„ loaderï¼Œå¯ä»¥ç›´æ¥é…ç½® resolveLoader.modulesã€‚

   ```js
   module.exports = {
     resolveLoader: {
       modules: ['node_modules', './loaders/']
     }
   }
   ```

   ä¸Šé¢é…ç½®ä¸­ï¼Œå½“åœ¨ node_modules ä¸­æ‰¾ä¸åˆ°ç›¸åº”çš„ loader æ—¶ï¼Œä¾¿ä¼šä» loaders æ–‡ä»¶å¤¹ä¸­å»å¯»æ‰¾ã€‚



## ç†è§£ Plugin

åœ¨ Webpack è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¹¿æ’­è®¸å¤šäº‹ä»¶ï¼ŒPlugin å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºé€šè¿‡ Webpack æä¾›çš„ API æ”¹å˜è¾“å‡ºç»“æœã€‚

åœ¨å¼€å‘ Plugin æ—¶æœ€å¸¸ç”¨çš„ä¸¤ä¸ªå¯¹è±¡æ˜¯ Compiler å¯¹è±¡å’Œ Compilation å¯¹è±¡ï¼Œå®ƒä»¬æ˜¯ Plugin å’Œ Webpack ä¹‹é—´çš„æ¡¥æ¢ã€‚

- Compiler å¯¹è±¡ï¼šåŒ…å«äº† Webpack ç¯å¢ƒçš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼ˆå³ optionsã€loadersã€plugins ç­‰ä¿¡æ¯ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸º Webpack å®ä¾‹ã€‚
- Compilation å¯¹è±¡ï¼šåŒ…å«äº†å½“å‰ Webpack çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚æ¯å½“ç›‘æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œä¾¿æœ‰ä¸€æ¬¡æ–°çš„ Compilation å¯¹è±¡è¢«åˆ›å»ºã€‚

é‚£ä¹ˆï¼Œ**Compiler å¯¹è±¡å’Œ Compilationå¯¹è±¡ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼ŸCompiler å¯¹è±¡ä»£è¡¨äº†æ•´ä¸ª Webpack ä»å¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation å¯¹è±¡åªä»£è¡¨ä¸€æ¬¡æ–°çš„ç¼–è¯‘**ã€‚

å¦å¤–ï¼Œ**Webpack é€šè¿‡ Tagable æ¥ç»„ç»‡è¿™æ¡å¤æ‚çš„ç”Ÿäº§çº¿ï¼Œåœ¨ Webpack çš„è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶ï¼ŒPlugin åªéœ€è¦ç›‘å¬å®ƒå…³å¿ƒçš„äº‹ä»¶ï¼Œå°±èƒ½åŠ å…¥è¿™æ¡ç”Ÿäº§çº¿ä¸­ï¼Œå¹¶èƒ½æ”¹å˜ç”Ÿäº§çº¿çš„è¿ä½œ**ã€‚

Webpack çš„äº‹ä»¶æµæœºåˆ¶é‡‡ç”¨çš„æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå’Œ Node.js ä¸­çš„ EventEmitter éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸” Compiler å¯¹è±¡å’Œ Compilation å¯¹è±¡éƒ½ç»§æ‰¿è‡ª Tapableï¼Œå¯åœ¨ Compiler å¯¹è±¡å’Œ Compilation å¯¹è±¡ä¸Šå¹¿æ’­å’Œç›‘å¬äº‹ä»¶ã€‚

```js
// å¹¿æ’­äº‹ä»¶
compiler.apply('eventName', params)

// ç›‘å¬äº‹ä»¶
compiler.plugin('eventName', function(params) { 
  //... 
})
```

å› æ­¤ï¼Œåœ¨ç¼–å†™ä¸€ä¸ª Plugin æ—¶ï¼Œå¯å¦‚ä¸‹æ“ä½œï¼š

```js
// TextPlugin.js
class TextPlugin {
  constructor(options) { // åœ¨æ„é€ å‡½æ•°ä¸­è·å–ç”¨æˆ·ä¸ºè¯¥æ’ä»¶ä¼ å…¥çš„é…ç½®
    // ...
  }
  apply(compiler) { // Webpackä¼šè°ƒç”¨TextPluginå®ä¾‹çš„applyæ–¹æ³•ä¸ºæ’ä»¶å®ä¾‹ä¼ å…¥compilerå¯¹è±¡
    compiler.plugin('eventName', function(params) {
      // ...
    })
  }
}
module.exports = TextPlugin // å¯¼å‡ºplugin

// webpack.config.js
const TextPlugin = require('./TextPlugin')
module.exports = {
  plugins: [
    new TextPlugin()
  ]
}
```





















